{% extends "layout.html" %}

{% block title %}
    Nexus
{% endblock %}

{% block main %}
<div class="row justify-content-center mt-3 mb-5">
    <div class="col-6">
        <img src="/static/image.png" class="main_image mx-auto d-block" alt="image of water representing the unconscious">
    </div>
</div>
<div class="row justify-content-center text-center text-white mt-5 mb-5" id="lines_container">
    <div class="col-8">
        <p class="h2 lines" id="line1"></p>
        <p class="h2 lines" id="line2"></p>
        <p class="h2 lines" id="line3"></p>
    </div>
</div>

<div class="row justify-content-center text-center">
    <div class="col-8">
        <form action="/entry" method="post">
            <input type="text" name="line" class="form-control">
            <button class="btn btn-primary mt-3" type="submit">Cast</button>
        </form>
    </div>
</div>

<script>
    function fetchLines() {
        fetch('/get_entries')
            .then(response => response.json())
            .then(data => {
                // Apply the pop animation class
                document.getElementById('line1').classList.add('pop');
                document.getElementById('line2').classList.add('pop');
                document.getElementById('line3').classList.add('pop');

                // Remove the pop class after animation and update content
                setTimeout(() => {
                    // Clear previous content and classes
                    clearAndAnimateLine('line1', data[0].line);
                    clearAndAnimateLine('line2', data[1].line);
                    clearAndAnimateLine('line3', data[2].line);
                }, 600); // 600ms matches the duration of the pop animation
            })
            .catch(error => console.error('Error fetching lines:', error));
    }

    function clearAndAnimateLine(elementId, text) {
        const lineElement = document.getElementById(elementId);
        lineElement.innerHTML = ''; // Clear previous content
        lineElement.classList.remove('pop');

        // Split text into letters and spaces, and wrap each letter in a span
        const letters = text.split('');
        const indices = Array.from(letters.keys());

        // Shuffle indices to randomize the appearance order
        shuffle(indices);

        for (let i = 0; i < letters.length; i++) {
            const span = document.createElement('span');
            span.textContent = letters[i];
            if (letters[i] === ' ') {
                span.classList.add('space');
            } else {
                span.classList.add('letter');
                // Apply animation delay based on shuffled order
                span.style.animation = `letter-appear 1s ${indices[i] * 0.03}s forwards`;
            }
            lineElement.appendChild(span);
        }
        lineElement.classList.add('bubble-up');
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // Fetch new lines every 15 seconds
    setInterval(fetchLines, 15600); // 15 seconds + 600ms pop animation

    // Initial fetch
    fetchLines();
</script>



{% endblock %}


